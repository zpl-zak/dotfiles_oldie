var buyingExp=/javascript:BuyMarketListing\('listing', '(\d+)', (\d+), '(\d+)', '(\d+)'\)/,linkExp=/\/\/steamcommunity\.com\/market\/listings\/(\d+)\/(.+)/;BuyCardSetDialog={m_bInitialized:!1,m_oItemsToBuy:[],m_fnDocumentKeyHandler:null,m_total:0,m_modal:null,m_elDialogContent:null,b_buyall:!1,Initialize:function(){$("market_buycardset_dialog_cancel")&&$("market_buycardset_dialog_cancel").observe("click",this.OnCancel.bindAsEventListener(this));$("market_buycardset_dialog_buyall").observe("click",this.OnBuyAll.bindAsEventListener(this));$("market_buycardset_dialog").style.visibility="hidden";$("market_buycardset_dialog").show();$("market_buycardset_dialog").hide();$("market_buycardset_dialog").style.visibility="";this.m_elDialogContent=$("market_buycardset_dialog");this.m_bInitialized=!0},Show:function(n){this.m_bInitialized||this.Initialize();m_oItemsToBuy=n;this.m_fnDocumentKeyHandler=this.OnDocumentKeyPress.bindAsEventListener(this);$(document).observe("keydown",this.m_fnDocumentKeyHandler);this.OnReload({stop:function(){}});this.m_modal=new CModal($J(this.m_elDialogContent));this.m_modal.Show()},RemoveItem:function(n){var t,i;for(console.log(n),t=0;t<m_oItemsToBuy.length;t++)if(i=m_oItemsToBuy[t],i.link===n){m_oItemsToBuy.splice(t,1);m_oItemsToBuy.length===0;return}},BuyFirstCard:function(){var t=$J("#lstParts .market_listing_row.market_recent_listing_row"),n=!0;t.each(function(){var t=$J(this),i=t.data(),e=t.find("input.sih-number-of-card"),o=t.find("input.sih-card-price"),r=parseInt(e.val()),u=GetPriceValueAsInt(o.val()+""),f={sessionid:g_sessionID,currency:g_rgWalletInfo.wallet_currency,appid:i.appid,market_hash_name:i.marketname,price_total:u*r,quantity:r};if(console.log(f),!i.done&&!(r<=0)&&u)return t.find(".sih-card-price").css({background:"url("+window.location.protocol+"//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif) no-repeat"}),n=!1,$J.ajax({url:"https://steamcommunity.com/market/createbuyorder/",type:"POST",data:f,crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(n){n.success==29?(t.data("done",!0),t.find(".sih-card-price").replaceWith("Already ordered")):n.success==1?(t.data("done",!0),t.find(".sih-card-price").replaceWith("Done")):n.success==10&&t.find(".market_listing_price.market_listing_price_with_fee").html("Error");window.setTimeout("BuyCardSetDialog.BuyFirstCard();",1500)}).fail(function(n){var t=$J.parseJSON(n.responseText);console.log(t)}),!1});n&&window.setTimeout("window.location.reload();",5e3)},Dismiss:function(){$(document).stopObserving("keydown",this.m_fnDocumentKeyHandler);this.m_modal&&this.m_modal.Dismiss()},OnCancel:function(n){this.Dismiss();n.stop()},OnAccept:function(n){n.stop()},OnReload:function(n){n.stop();$J("#lstParts").html("");$J(".badge_card_to_collect").each(function(){var u=$J(this).find("img").attr("src"),f=$J(this).find(".badge_card_set_text:nth-child(2)").text(),e=$J(this).find('a[href*="/market/listings/"]').attr("href"),r=linkExp.exec(e),t=r[1],i=decodeURIComponent(r[2]).replace(/#/g,"%23"),o={appid:t,marketname:i},s=window.location.protocol+"//steamcommunity.com/market/priceoverview/?appid="+t+"&country="+g_rgWalletInfo.wallet_country+"&currency="+g_rgWalletInfo.wallet_currency+"&market_hash_name="+i,n=$J('<div class="market_listing_row market_recent_listing_row">');n.append('<div class="market_listing_item_img_container"><img src="'+u+'" class="market_listing_item_img" /><\/div>');n.append('<div class="market_listing_right_cell market_listing_their_price"><div style="float: right"><input type="number" value="" placeholder="Loading" min="0.03" step="0.01" class="market_dialog_input sih-card-price" style="width: 60px; text-align: right; padding-right: 3px; margin-top: 5px; background: #1a1a1a; border: rgb(112, 112, 112) 1px solid; color: #909090;" /><\/div><\/div>');n.append('<div class="market_listing_item_name_block"><div style="float: right"><input type="number" value="1" min="0" class="market_dialog_input sih-number-of-card" style="width: 60px; text-align: right; padding-right: 3px; margin-top: 5px; background: #1a1a1a; border: rgb(112, 112, 112) 1px solid; color: #909090;" /><\/div><span class="market_listing_item_name">'+f+'<\/span><br /><span class="market_listing_game_name">'+t+" "+i.replace(/%23/g,"#")+'<\/span><\/div><div style="clear: both"><\/div>');n.data(o);$J.ajax({method:"GET",url:s,success:function(t){var i=0,u=0,r;t.success&&t.median_price&&(i=t.lowest_price,u=t.median_price,r=parseFloat(getNumber(i)),n.find(".sih-card-price").val(r),n.find(".sih-card-price").prop("placeholder",i),BuyCardSetDialog.CalculateTotal())},error:function(){}});$J("#lstParts").append(n)});var t=/\/steamcommunity.com\/(.+)\/gamecards\/(\d+)/.exec(window.location.href)[2];console.log(t);$J(".badge_card_set_card.owned").each(function(){var i=$J(this).find(".badge_card_set_text.ellipsis").clone();i.find(".badge_card_set_text_qty").remove();var e=$J(this).find("img.gamecard").attr("src"),u=$J(i[0]).text().trim(),f=$J(i[1]).text().trim();console.log(u);console.log(f);var r=t+"-"+decodeURIComponent(u).replace(/#/g,"%23"),o={appid:753,marketname:r},s=window.location.protocol+"//steamcommunity.com/market/priceoverview/?appid=753&country="+g_rgWalletInfo.wallet_country+"&currency="+g_rgWalletInfo.wallet_currency+"&market_hash_name="+r,n=$J('<div class="market_listing_row market_recent_listing_row">');n.append('<div class="market_listing_item_img_container"><img src="'+e+'" class="market_listing_item_img" /><\/div>');n.append('<div class="market_listing_right_cell market_listing_their_price"><div style="float: right"><input type="number" value="" placeholder="Loading" min="0.03" step="0.01" class="market_dialog_input sih-card-price" style="width: 60px; text-align: right; padding-right: 3px; margin-top: 5px; background: #1a1a1a; border: rgb(112, 112, 112) 1px solid; color: #909090;" /><\/div><\/div>');n.append('<div class="market_listing_item_name_block"><div style="float: right"><input type="number" value="0" min="0" class="market_dialog_input sih-number-of-card" style="width: 60px; text-align: right; padding-right: 3px; margin-top: 5px; background: #1a1a1a; border: rgb(112, 112, 112) 1px solid; color: #909090;" /><\/div><span class="market_listing_item_name">'+f+'<\/span><br /><span class="market_listing_game_name">753 '+r.replace(/%23/g,"#")+'<\/span><\/div><div style="clear: both"><\/div>');n.data(o);$J.ajax({method:"GET",url:s,success:function(t){var i=0,u=0,r;t.success&&t.median_price&&(i=t.lowest_price,u=t.median_price,r=parseFloat(getNumber(i)),n.find(".sih-card-price").val(r),n.find(".sih-card-price").prop("placeholder",i),BuyCardSetDialog.CalculateTotal())},error:function(){var t=n.data("marketname");t.indexOf("(Trading Card)")==-1?(t=t+" (Trading Card)",n.data("marketname",t),$J.ajax({method:"GET",url:"//steamcommunity.com/market/priceoverview/?appid=753&country="+g_rgWalletInfo.wallet_country+"&currency="+g_rgWalletInfo.wallet_currency+"&market_hash_name="+t,success:function(t){var i=0,u=0,r;t.success&&t.median_price&&(i=t.lowest_price,u=t.median_price,r=parseFloat(getNumber(i)),n.find(".sih-card-price").val(r),n.find(".sih-card-price").prop("placeholder",i),BuyCardSetDialog.CalculateTotal())},error:function(){n.remove()}})):n.remove()}});$J("#lstParts").append(n)})},OnBuyAll:function(n){n.stop();this.b_buyall=!0;this.BuyFirstCard();$J("#market_buycardset_dialog_buyall").prop("disabled",!0)},CalculateTotal:function(){var n=$J("#lstParts .market_listing_row.market_recent_listing_row");BuyCardSetDialog.m_total=0;n.each(function(){var n=$J(this),f=n.data(),r=n.find("input.sih-number-of-card"),u=n.find("input.sih-card-price"),t=parseInt(r.val()),i=GetPriceValueAsInt(u.val()+"");console.log(i,t);i&&t&&(BuyCardSetDialog.m_total+=i*t/100)});$J("#market_buycardset_dialog_buyall span").text(SIHLang.tradingcards.buyall+" ("+formatNumber(BuyCardSetDialog.m_total)+")")},OnDocumentKeyPress:function(n){n.keyCode==Event.KEY_ESC&&(this.Dismiss(),n.stop())}};var AddBuyCardSet=function(){var n='<div id="market_buycardset_dialog" class="newmodal" style="display: none; min-width: 570px"><div class="newmodal_header_border"><div class="newmodal_header"><span id="market_sell_dialog_title">'+SIHLang.tradingcards.dialogtitle+'<\/span><div id="market_buycardset_dialog_cancel" class="newmodal_close"><\/div><\/div><\/div><div class="newmodal_content_border"><div class="newmodal_content"><div class="market_dialog_content"><div class="market_dialog_iteminfo"><div id="lstParts" class="market_content_block market_home_listing_table market_home_main_listing_table market_listing_table"><\/div><\/div><\/div><div class="market_dialog_content_separator"><\/div><div class="market_dialog_content market_dialog_content_dark"><div class="market_sell_dialog_input_area"><a id="market_buycardset_dialog_buyall" href="#" class="btn_green_white_innerfade btn_small_wide" style="margin-right:10px"><span>'+SIHLang.tradingcards.buyall+"<\/span><\/a><div>&nbsp;<br /><br /><\/div><\/div><\/div><\/div><\/div><\/div>";n+='<div id="hover" style="display: none; z-index: 1000"><div class="shadow_ul"><\/div><div class="shadow_top"><\/div><div class="shadow_ur"><\/div><div class="shadow_left"><\/div><div class="shadow_right"><\/div><div class="shadow_bl"><\/div><div class="shadow_bottom"><\/div><div class="shadow_br"><\/div> <div class="inventory_iteminfo hover_box shadow_content" id="iteminfo_clienthover"><div class="item_desc_content" id="hover_content"><div class="item_desc_icon"><div class="item_desc_icon_center"><img id="hover_item_icon" src="'+window.location.protocol+'//steamcommunity-a.akamaihd.net/public/images/trans.gif" alt="" /><\/div><\/div><div class="item_desc_description"><h1 class="hover_item_name" id="hover_item_name"><\/h1><div class="fraud_warning" id="hover_fraud_warnings"><\/div><div class="item_desc_game_info" id="hover_game_info"><div class="item_desc_game_icon"><img id="hover_game_icon" src="'+window.location.protocol+'//steamcommunity-a.akamaihd.net/public/images/trans.gif" alt="" /><\/div><div id="hover_game_name" class="ellipsis"><\/div><div id="hover_item_type" class=""><\/div><\/div><div class="item_desc_descriptors" id="hover_item_descriptors"><\/div><div class="item_desc_descriptors" id="hover_item_owner_descriptors"><\/div><\/div><\/div><\/div><div class="hover_arrow_left" id="hover_arrow_left"><div class="hover_arrow_inner"><\/div><\/div><div class="hover_arrow_right" id="hover_arrow_right"><div class="hover_arrow_inner"><\/div><\/div><\/div>';$J("body").append(n);$J("#lstParts").on("change","input[type=number]",function(){BuyCardSetDialog.CalculateTotal()})},g_rgWalletInfo=null,g_strLanguage="english",g_rgAppContextData={},missingCards=[];setTimeout(function(){var t=$J(".badge_card_to_collect_links"),n;$J(".gamecards_inventorylink").append('<a class="btn_grey_grey btn_small_thin" id="bt_buyMissings" href="javascript:void(0)"><span data-lang="tradingcards.showpopup">'+SIHLang.tradingcards.showpopup+"<\/span><\/a>");n=$J(".popup_menu_item.header_notification_items").attr("href");$J.ajax({url:n,success:function(res){var expWallet=/g_rgWalletInfo = .+?;/,m=expWallet.exec(res);m&&eval(m[0]);m=/g_strLanguage = .+?;/.exec(res);m&&eval(m[0]);$J("#bt_buyMissings").click(function(){BuyCardSetDialog.Show(missingCards)})}});missingCards=[];t.each(function(){var n=$J(this).find('a[href*="/market/listings/"]');n.length<1||missingCards.push({link:n.attr("href")})});AddBuyCardSet();ReloadLang()},10);
/*
//# sourceMappingURL=badge.script.min.js.map
*/