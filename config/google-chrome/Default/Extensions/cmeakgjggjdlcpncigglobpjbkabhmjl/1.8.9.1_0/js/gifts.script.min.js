function SendGifts(){var n,i;if(!g_bSendGiftCallRunning){if(n=null,$J("[data-giftid]").each(function(){var t=$J(this).data();if(!t.done)return n=t.giftid,$J(this).data("done",!0),$J(this).find(".loading").show(),!1}),n)console.log("Sending: "+n);else return console.log("Done"),OnSendGiftSuccess(cacheResult),!1;var r=0,t="",u="",f="",e="",o="";try{$("send_via_email").checked?(t=$("email_input").value,i=SplitGmail(t),i.length==2?(t=i[0]+"+"+n+i[1],isGmail=!0):isGmail=!1):r=currently_selected_friend_id;u=$("gift_recipient_name").value;f=$("gift_message_text").value;e=$("gift_sentiment").value;o=$("gift_signature").value;g_bSendGiftCallRunning=!0;new Ajax.Request("https://store.steampowered.com/checkout/sendgiftsubmit/",{method:"post",parameters:{GifteeAccountID:r,GifteeEmail:t,GifteeName:u,GiftMessage:f,GiftSentiment:e,GiftSignature:o,GiftGID:n,SessionID:g_sessionID},onSuccess:function(t){if(g_bSendGiftCallRunning=!1,t.responseJSON&&t.responseJSON.success){var i=t.responseJSON.success;i==1||i==22?($J("[data-giftid="+n+"] .loading").html("Done"),(!$("send_via_email").checked||isGmail)&&SendGifts(),cacheResult=i):OnSendGiftFailure(i)}else OnSendGiftFailure(2)},onFailure:function(){g_bSendGiftCallRunning=!1;OnSendGiftFailure(3)}})}catch(s){ReportCheckoutJSError("Failed gathering form data and calling DoSendGift",s)}}}var giftsID=[],cacheResult=null,isGmail=!1,SplitGmail=function(n){n=n.toLowerCase().trim();var t=n.lastIndexOf("@gmail.com");return t==-1?[n]:n.substring(t)!="@gmail.com"?[n]:[n.substring(0,t),n.substring(t)]},InitGifts=function(){var t=window.location.href,i=t.indexOf(""+g_gidGift),n=t.substring(i).split("/");$J(".friend_block.disabled input[type=radio]").prop("disabled",!1);$J(".friend_block.disabled").removeClass("disabled");n.length>2&&$J.ajax({url:"//steamcommunity.com/profiles/"+n[n.length-1]+"/inventory/json/753/1",success:function(t){var e,r,f,i,u,o;if(t&&t.success){for(e=t.rgInventory,i=0;i<n.length-1;i++)r=e[n[i]],r&&giftsID.push({id:r.id,des:t.rgDescriptions[r.classid+"_"+r.instanceid]});if(giftsID.length){for(f=$J($J(".checkout_tab")[0]),f.empty(),i=0;i<giftsID.length;i++)u=giftsID[i],o='<div class="sendgift_review_item checkout_review_cart_item even" data-giftid="'+u.id+'"><div class="checkout_review_item_img"><img src="//steamcommunity-a.akamaihd.net/economy/image/'+u.des.icon_url_large+'/120x45" width="120" height="45" border="0"><\/div><div class="checkout_review_item_desc"><div class="checkout_review_item_platform loading" style="display: none"><span class="platform_img" style="width: 32px; height: 32px; background: url(//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif)"><\/span><\/div>'+u.des.name+'<br><span class="checkout_review_item_desc_ext" id="sendgift_willbesentto" style="display: none;">Sending to: <span id="sendto_steamaccount">Steam account &nbsp;<span class="sendto_accountname" id="sendto_steamaccount_value"><\/span><\/span><span id="sendto_email">Email address &nbsp;<span class="sendto_accountname" id="sendto_email_value"><\/span><\/span>\t\t\t\t\t\t\t<\/span><\/div><\/div>',f.append(o);SendGift=SendGifts}}}})};$J(function(){InitGifts()});
/*
//# sourceMappingURL=gifts.script.min.js.map
*/