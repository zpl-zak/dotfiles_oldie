LPPlatform={};
(function(c){c.getBigIcons=function(a){var b=opendb();createDataTable(b);if(b){var c=function(c,b){a(0<b.rows.length&&null!==b.rows.item(0).data?b.rows.item(0).data:"")};if(g_indexeddb){var d={rows:{item:function(a){return this[a]},length:0}};b.transaction("LastPassData","readonly").objectStore("LastPassData").openCursor(IDBKeyRange.only(db_prepend(g_username_hash)+"_bigicons")).onsuccess=function(a){(a=a.target.result)?(d.rows[d.rows.length]=a.value,d.rows.length++,a["continue"]()):c(null,d)}}else b.transaction(function(a){a.executeSql("SELECT * FROM LastPassData WHERE username_hash=? AND type=?",
[db_prepend(g_username_hash),"bigicons"],c,function(a,b){console_log(b)})})}};c.saveBigIcons=function(a){var b=opendb();createDataTable(b);b&&(g_indexeddb?b.transaction("LastPassData","readwrite").objectStore("LastPassData").put({username_hash:db_prepend(g_username_hash),type:"bigicons",data:a,usertype:db_prepend(g_username_hash)+"_bigicons"}):b.transaction(function(b){b.executeSql("REPLACE INTO LastPassData (username_hash, type, data) VALUES (?, ?, ?)",[db_prepend(g_username_hash),"bigicons",a],
function(){console_log("server.js : inserted")},function(a,b){console_log(b)})}))};c.updateBigIcons=function(){};var f=function(a,b){for(var c in a){var d=b[c];d&&(d.group=a[c])}};c.refreshGroupNames=function(a){a&&(f(a.sites,g_sites),f(a.notes,g_securenotes),f(a.applications,g_applications))};c.useDialogWindows=function(){return Preferences.get("htmlindialog")};var h={},j=function(a,b){return function(){a.apply(this,arguments);b.apply(this,arguments)}};c.openTabDialog=function(a,b){var g=a+(b?"-"+
JSON.stringify(b):""),d=h[g];if(d)c.activateDialog(d);else{var e={dialogWindow:c.useDialogWindows()&&(void 0===b||!b.virtualKeyboard)},d={url:getchromeurl("tabDialog.html?dialog="+a),loadHandler:j(c.openDialogLoadHandler("openDialog",[a,c.copyDataIfEdge(b),e]),function(a){h[g]=a}),closeHandler:function(){delete h[g]}};if(e.dialogWindow){var f=Preferences.get("dialogSizePrefs"),e=f[a];d.features={height:e?e.height:600,width:e?e.width:800,left:e?e.left:0,top:e?e.top:0};d.closeHandler=j(d.closeHandler,
function(b){f[a]={height:b.outerHeight,width:b.outerWidth,left:b.screenLeft||b.screenX,top:b.screenTop||b.screenY};Preferences.set("dialogSizePrefs",f);delete h[g]});c.openDialogWindow(d)}else switch(Preferences.get("openpref")){case "tabs":c.openTab(d);break;case "windows":c.openWindow(d);break;case "same":c.openSame(d)}}};c.stringifyFeatures=function(a){var b=[],c;for(c in a)b.push(c+"="+a[c]);return b.join(",")};c.doAjax=function(a){LPServer.ajax(a)};c.ajax=function(a){isOffline()?a.error&&a.error(null,
null,"offline"):c.doAjax(a)};c.isEdge=function(){"undefined"===typeof this._isEdge&&(this._isEdge=-1!=navigator.userAgent.indexOf(" Edge/"));return this._isEdge};c.copyDataIfEdge=function(a){return c.isEdge()&&"undefined"!==typeof a?JSON.parse(JSON.stringify(a)):a}})(LPPlatform);
